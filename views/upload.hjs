<!DOCTYPE html>
<html>
<head>
	<title>{{ title }}</title>
	<link rel='stylesheet' href='/bower_components/semantic-ui/dist/semantic.min.css' />
	<link rel='stylesheet' href='/css/layout.css' />
	<link rel='stylesheet' href='/css/upload.css' />
</head>
<body>
	<div class="ui container">
		<h1>{{ title }}</h1>
		<div class="ui equal width grid">
			<section class="project--upload column">
		        <h3 class="segment-title">
		            <span class="ch">上傳檔案</span><span class="en">Upload</span>
		        </h3>
		        <form class="form" method="post" action="/upload" enctype="multipart/form-data">
		            <div class="field">
		                <input id="project__title" type="text" maxlength="40" name="title">
		                <label for="project__title">作品名稱</label>
		            </div>
		            <div class="field">
		            	<label for="project__cata">分類 Catalog</label>
		            	<select name="catalog" class="ui dropdown" id="project__cata">
		                	<option value="graphic">圖形設計</option>
		                	<option value="illustration">插圖</option>
		                	<option value="photo">攝影</option>
		                	<option value="ui">介面設計</option>
		                	<option value="ixd">交互設計</option>
		                	<option value="ad">設計指導</option>
		                	<option value="animation">動畫</option>
		                	<option value="layout">排版</option>
		                	<option value="font">字型設計</option>
		                	<option value="branding">品牌推廣</option>
		                	<option value="expo">實驗</option>
		                	<option value="copy">短篇文字</option>
		                </select>
		            </div>
		            <div class="field">
		            	<div class="ui toggle checkbox">
		            		<input name="status" type="checkbox" checked="checked" id="project__status">
	       	 				<label>Do not include a receipt in the package</label>
		            	</div>
		            </div>
		            <div class="field">
		                <textarea id="project__content" name="content"></textarea>
		                <label for="project__content">內容  Content</label>
		            </div>

        			<div class="field">
        				上傳圖片
        				<input type="file"  id="input_image" name='cover'>
        			</div>
        			<div class="field">
        				上傳內容
        				<input type="file"  id="" name='gallery'>
        				<input type="file"  id="" name='gallery'>
        			</div>
					<input type="submit" id="upload--project">
		            <!--<div class="ui two attached buttons">
		                <div class="ui vertical animated button send" id="upload--project">
		                    <div class="visible content">上傳</div>
		                    <div class="hidden content">
		                        <i class="send Outline icon"></i>
		                    </div>
		                </div>
		            </div>-->
		        </form>
		    </section>
		    <section class="column">
		    	<h3 class="segment-title">
		            <span class="ch">作品列表</span>
		        </h3>
		        <div>
		        	<br>
		        	<br>
		        	{{#p_con}}
		        		<div style=" border: 1px solid red">
		        			<!--<b class="id"> {{id}} </b>-->
		        			<p>{{project_title}}</p>
		        			<p>{{project_catalog}}</p>
		        			<b> {{cover}} </b>
		        			<b> {{project_content}} </b>
		        			{{#gallery}}
		        			<div style="color: red"> {{.}} </div>
		        			{{/gallery}}
		        			<!--<img src="/images/pro_test.jpg" alt="">-->
		        			<img src= /images/projects/{{cover}} alt="" style="width: 100%">
		        			{{#gallery}}
		        			<img src= /images/projects/{{.}} alt="" style="width: 100%">
		        			{{/gallery}}
		        			
		        			<a href= /upload/del/{{id}} >刪除</a>
		        			
		        			<section>
		        				<input type="text" name="new_w" class="new_input">
		        				<!--<div class="js-update">ewfewf</div>-->
		        				<a href= /upload/edit/{{id}} class="js-update">更新</a>
		        			</section>
		        		</div>
		        	{{/p_con}}
		        </div>
		    </section>
		    <!--<section class="column">
		    	<h3 class="segment-title">
		            <span class="ch">圖片上傳測試</span>
		        </h3>
		        <form class="form" method="post" enctype="multipart/form-data" action="/upload/img">
		        	<input type="file" name="test_photo">
		        	<button type="submit" name="submit">上傳</button>
		        </form>
		    </section>-->
		</div>
	</div>
</body>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.0.0-alpha1/jquery.min.js" ></script>
<script src="http://malsup.github.com/jquery.form.js"></script> 
<script src="/bower_components/semantic-ui/dist/semantic.min.js"></script>
<!--
<script src="/js/min/layout.min.js"></script>
-->

<script>
	$('.ui.dropdown').dropdown();
</script>
<script>


	$('#upload--project').click(function() {
		var project = {};
		function drop(){
			if( $('#project__status').prop('checked') == true ){
				return true;
			}else{
				return false;
			}
		}
		function url_rename(){
			var ori = $('#project__cover').val();
			var url_name = ori.replace("C:\\fakepath\\", "");;
			return url_name;
		}
		project.title   = $('#project__title').val();
		project.cata    = $('#project__cata').val();
		project.content = $('#project__content').val();
		project.status  = drop();
		//project.image   = $('#input_image').val();


		//console.log(project.title, project.cata, project.content, project.status );
		//console.log(project);
		ajax_post(project);
	});
	
	function ajax_post(jsonData){
		//換寫法
		//$.post('/upload', jsonData, function(){
		//	console.log('上傳中');
		//})
		$.ajax = ({ 	//改成 $.ajaxSubmit
			type: 'POST',
			url: '/upload',
			data: jsonData,
			dataType: 'json',
			success: function(res){
				console.log(res);
			},
			error: function(err){
				console.log(err);
			}
		})
	}
	



	
	$('.js-update').click(function(event) {
		var _url = $(this).attr('href');
		var _obj = {};
		_obj.newInput = $(this).siblings('.new_input').val();
		
		console.log(_obj);
		$.ajax({
			url: _url,
            data: _obj,
            type:"POST",
            dataType:'json',
		})
		//return false;  // cancel link default action
	});

</script>
<script>
	$('.del').click(function(event) {
		var ta = $(this).siblings('.id').text();
		$.post('/del', ta);
	});
</script>
</html>
